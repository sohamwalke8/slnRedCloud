@model IEnumerable<RedCloud.ViewModel.MessagingUsersVM>
 
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    a {
        text-decoration: none;
    }

    .dataTables_wrapper .top {
        margin-top: 0;
    }

    #dataTable {
        width: 100% !important;
    }

    .dt-search {
        float: right;
        margin-bottom: 2px;
    }

    .table {
        width: 100%;
        max-width: 100%;
        margin-bottom: 1rem;
        background-color: transparent;
    }

        .table th,
        .table td {
            padding: 1rem;
            vertical-align: top;
            border-top: 1px solid #dee2e6;
        }

        .table thead th {
            vertical-align: bottom;
            border-bottom: 2px solid #dee2e6;
        }

        .table tbody + tbody {
            border-top: 2px solid #dee2e6;
        }

    .table-bordered {
        border: 1px solid #dee2e6;
    }

        .table-bordered th,
        .table-bordered td {
            border: 1px solid #dee2e6;
        }

        .table-bordered thead th,
        .table-bordered thead td {
            border-bottom-width: 2px;
        }

    .status-active {
        color: white;
        background-color: green;
        padding: 0.2rem 0.5rem;
        border-radius: 0.25rem;
    }

    .status-inactive {
        color: white;
        background-color: red;
        padding: 0.2rem 0.5rem;
        border-radius: 0.25rem;
    }

    .btn-action {
        margin-right: 0.5rem;
    }

    / Custom CSS for DataTables Buttons /
    .dt-button {
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 0.25rem;
        padding: 0.5rem 1rem;
        margin: 0.2rem;
        font-size: 0.875rem;
        cursor: pointer;
    }

    .dt-button:hover {
        background-color: #0056b3;
    }

    / Custom CSS for DataTables Pagination /
    .dataTables_paginate .paginate_button {
        background-color: #007bff;
        color: white !important;
        border: none;
        border-radius: 0.25rem;
        padding: 0.5rem 1rem;
        margin: 0.2rem;
        font-size: 0.875rem;
        cursor: pointer;
    }

    .dataTables_paginate .paginate_button:hover {
        background-color: #0056b3;
    }

    .dataTables_paginate .paginate_button.current {
        background-color: #0056b3;
        color: white !important;
    }

    / Custom CSS for Entries Dropdown /
    .dataTables_length select {
        border: 1px solid #007bff;
        border-radius: 0.25rem;
        padding: 0.25rem;
        margin: 0.2rem;
    }
</style>

<form method="post" id="user-query-form" action="/MessagingUser/AddMessagingUser" novalidate="novalidate">
    <div class="card-body">

        <div class="card">
            <div class="card-header" style="background-color:#007BFF">
                <h3 class="card-title" style="color:white; font-weight:bold;font-size:23px;">Manage MessagingUser</h3>
            </div>
            <!-- /.card-header -->
            <div class="card-body">
                <div id="dataTable_wrapper" class="dataTables_wrapper dt-bootstrap4">
                    <div class="row">
                        <div class="col-sm-12">
                            <p>
                                <a class="btn btn-primary" asp-action="AddMessagingUser" asp-controller="MessagingUser"
                                   style="--bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem; float:right; margin-bottom:10px">
                                    Add Messaging User
                                </a>
                            </p>
                            <label for="entriesPerPage">
                                Show Entries
                                <select id="entriesPerPage" class="custom-select custom-select-sm form-control form-control-sm">
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                            </label>
                            <table id="dataTable" class="table table-bordered table-striped dataTable dtr-inline" aria-describedby="dataTable_info">
                                <thead>
                                    <tr>
                                        <th>First Name</th>
                                        <th>Last Name</th>
                                        <th>Email</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model)
                                    {
                                        <tr>
                                            <td>@Html.DisplayFor(modelItem => item.MessagingUserFirstName)</td>
                                            <td>@Html.DisplayFor(modelItem => item.MessagingUserLastName)</td>
                                            <td>@Html.DisplayFor(modelItem => item.MessagingUserEmail)</td>
                                            <td>
                                                <span class="@(item.IsActive ? "status-active" : "status-inactive")">
                                                    @((bool)item.IsActive ? "Active" : "Not Active")
                                                </span>
                                            </td>
                                            <td>
                                                <a asp-action="ViewMessagingUserDetails" asp-controller="MessagingUser" asp-route-id="@item.MessagingUserId" class="btn-action" style="text-decoration:none">
                                                    <i class="fa-solid fa-eye" style="color: #050505;"></i>
                                                </a>

                                               

                                                <a href="@Url.Action("EditMessagingUser", "MessagingUser", new { Id = item.MessagingUserId })" class="btn-action" style="text-decoration:none">
                                                        <i class="fa-regular fa-pen-to-square" style="color: #050505;"></i>
                                                </a>

                                                @* <a class="delete-btn btn-action" data-id="@item.MessagingUserId" data-name="@item.MessagingUserFirstName" href="#" style="text-decoration:none">
                                                    <i class="fa-solid fa-trash" style="color: #cb1010;"></i>
                                                </a> *@

                                                @if (item.IsActive)
                                                {
                                                    <a class="block-btn btn-action"
                                                       data-id="@item.MessagingUserId"
                                                       data-name="@item.MessagingUserFirstName"
                                                       data-block-url="@Url.Action("BlockMessagingUser", "MessagingUser", new { id = item.MessagingUserId })"
                                                       href="#" style="text-decoration:none">
                                                        <i class="fa-solid fa-ban" style="color: #cb1010;"></i>
                                                    </a>
                                                }
                                                else
                                                {
                                                    <a class="unblock-btn btn-action"
                                                       data-id="@item.MessagingUserId"
                                                       data-name="@item.MessagingUserFirstName"
                                                       data-unblock-url="@Url.Action("BlockMessagingUser", "MessagingUser", new { id = item.MessagingUserId })"
                                                       href="#" style="text-decoration:none">
                                                        <i class="fa-solid fa-check-circle" style="color: #28a745;"></i>
                                                    </a>
                                                }

                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.card-body -->
        </div>


    </div>
    <!-- Modal for confirmation -->
    <div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="confirmationModalLabel" aria-hidden="true">
        <div class="modal-dialog " - role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmationModalLabel">Confirmation</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p id="modalMessage"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmActionBtn">Confirm</button>
                </div>
            </div>
        </div>
    </div>

</form>

@section Scripts {
    <!-- Include necessary libraries -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Toastr CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />

    <!-- Toastr JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

    <!-- DataTables CSS and JS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.dataTables.min.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

   
    <script>
        $(document).ready(function () {
            $('.block-btn').on('click', function (e) {
                e.preventDefault();
                var userId = $(this).data('id');
                var userName = $(this).data('name');
                var blockUrl = $(this).data('block-url');

                $('#modalMessage').text('Are you sure you want to block ' + userName + '?');
                $('#confirmationModal').modal('show');

                $('#confirmActionBtn').off('click').on('click', function () {
                    $.ajax({
                        type: 'PUT',
                        url: blockUrl,
                        success: function (response) {
                            toastr.success('Messaging User blocked successfully.', 'Success');
                            $('#confirmationModal').modal('hide');
                            location.reload();
                        },
                        error: function (xhr, status, error) {
                            console.error(error);
                            toastr.error('Failed to block messaging user. Please try again later.', 'Error');
                            $('#confirmationModal').modal('hide');
                        }
                    });
                });
            });

            $('.unblock-btn').on('click', function (e) {
                e.preventDefault();
                var userId = $(this).data('id');
                var userName = $(this).data('name');
                var unblockUrl = $(this).data('unblock-url');

                $('#modalMessage').text('Are you sure you want to unblock ' + userName + '?');
                $('#confirmationModal').modal('show');

                $('#confirmActionBtn').off('click').on('click', function () {
                    $.ajax({
                        type: 'PUT',
                        url: unblockUrl,
                        success: function (response) {
                            toastr.success('Messaging User unblocked successfully.', 'Success');
                            $('#confirmationModal').modal('hide');
                            location.reload();
                        },
                        error: function (xhr, status, error) {
                            console.error(error);
                            toastr.error('Failed to unblock messaging user. Please try again later.', 'Error');
                            $('#confirmationModal').modal('hide');
                        }
                    });
                });
            });
        });


    </script>




}

